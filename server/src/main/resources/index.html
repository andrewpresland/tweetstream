<!DOCTYPE html>
<meta charset="utf-8">
<title>Streamgraph</title>
<style>

button {
  position: absolute;
  left: 10px;
  top: 10px;
}

</style>
<button onclick="transition()">Update</button>
<svg width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

d3.json("http://localhost:9090/sentiments", function(data) {

  var sentiment = 0
  var hostile = data.zero;
  var negative = data.one;
  var neutral = data.two;
  var positive = data.three;

  var n = data.dimension - 1, // number of layers
      m = data.length; // number of samples per layer

  var stack = d3.stack().keys(d3.range(n)).offset(d3.stackOffsetWiggle),
      layers0 = stack(d3.transpose(d3.range(n).map(function() { return sentiments(); }))),
      layers1 = stack(d3.transpose(d3.range(n).map(function() { return sentiments(); }))),
      layers = layers0.concat(layers1);

  var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");

  var x = d3.scaleLinear()
      .domain([0, m - 1])
      .range([0, width]);

  var y = d3.scaleLinear()
      .domain([d3.min(layers, stackMin), d3.max(layers, stackMax)])
      .range([height, 0]);

  var z = d3.interpolateCool;

  var area = d3.area()
      .x(function(d, i) { return x(i); })
      .y0(function(d) { return y(d[0]); })
      .y1(function(d) { return y(d[1]); });

  svg.selectAll("path")
    .data(layers0)
    .enter().append("path")
      .attr("d", area)
      .attr("fill", function() { return z(Math.random()); });

  function stackMax(layer) {
    return d3.max(layer, function(d) { return d[1]; });
  }

  function stackMin(layer) {
    return d3.min(layer, function(d) { return d[0]; });
  }

  function transition() {
    var t;
    d3.selectAll("path")
      .data((t = layers1, layers1 = layers0, layers0 = t))
      .transition()
        .duration(2500)
        .attr("d", area);
  }

  function sentiments() {
    if (sentiment == 0 ) {++sentiment; return hostile;}
    else if (sentiment == 1 ) {++sentiment; return negative;}
    else if (sentiment == 2 ) {++sentiment; return neutral;}
    else {++sentiment; return positive;}
  }

});

</script>
